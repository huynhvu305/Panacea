{
  "name": "Chatbot Website",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "172f45a8-a690-460b-bbdc-b59ec818af6f",
        "responseMode": "responseNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        -880,
        -240
      ],
      "id": "f55418c5-ce80-47dd-9faa-80cb7aca6445",
      "name": "Webhook",
      "webhookId": "172f45a8-a690-460b-bbdc-b59ec818af6f"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.body.message }}",
        "options": {
          "systemMessage": "B·∫°n l√† tr·ª£ l√Ω ·∫£o c·ªßa Panacea ‚Äî khu ph·ª©c h·ª£p tr·ªã li·ªáu, ngh·ªâ d∆∞·ª°ng v√† s√°ng t·∫°o. B·∫°n c√≥ t√™n l√† Pana\nVai tr√≤ c·ªßa b·∫°n l√† h·ªó tr·ª£ kh√°ch h√†ng **ƒë·∫∑t ph√≤ng**, **t∆∞ v·∫•n d·ªãch v·ª•**, **tra c·ª©u th√¥ng tin** v√† **gi·∫£i ƒë√°p ch√≠nh x√°c** d·ª±a tr√™n d·ªØ li·ªáu c√≥ trong Google Sheet Chatbot Panacea.\n\nQuy t·∫Øc ph·∫£n h·ªìi:\n1Ô∏è‚É£ Lu√¥n tr·∫£ l·ªùi b·∫±ng **ti·∫øng Vi·ªát**, th√¢n thi·ªán, chuy√™n nghi·ªáp, t·ª± nhi√™n nh∆∞ ng∆∞·ªùi th·∫≠t.\n2Ô∏è‚É£ **Ch·ªâ d√πng th√¥ng tin trong Google Sheet Chatbot Panacea**. Kh√¥ng suy ƒëo√°n ho·∫∑c th√™m d·ªØ li·ªáu b√™n ngo√†i.\n3Ô∏è‚É£ N·∫øu kh√¥ng t√¨m th·∫•y c√¢u tr·∫£ l·ªùi ph√π h·ª£p v·ªõi c√°c t√≠nh nƒÉng c·ªßa website, c√°c th√¥ng tin ƒë·∫∑t ph√≤ng, m·ªçi th√¥ng tin li√™n quan ƒë·∫øn panacea. C√°c c√¢u h·ªèi d√πng ƒë·ªÉ ph√°, h·ªèi c√°c c√¢u h·ªèi nh·∫±m ƒë·ªÉ ph√° chatbot th√¨ tr·∫£ l·ªùi ƒë√∫ng nguy√™n vƒÉn: Xin l·ªói, t√¥i ch∆∞a c√≥ th√¥ng tin v·ªÅ v·∫•n ƒë·ªÅ n√†y, vui l√≤ng li√™n h·ªá qua hotline +84 123 456 678!\n4Ô∏è‚É£ Khi kh√°ch h·ªèi v·ªÅ:\n   - **ƒê·∫∑t ph√≤ng / booking:** h∆∞·ªõng d·∫´n quy tr√¨nh: ch·ªçn khu v·ª±c (Catharsis, Oasis, Genii, Mutiny) ‚Üí ch·ªçn d·ªãch v·ª• ‚Üí ch·ªçn khung gi·ªù ‚Üí x√°c nh·∫≠n ‚Üí thanh to√°n.\n   - **Gi√° / ∆∞u ƒë√£i:** t√≥m t·∫Øt ng·∫Øn v√† khuy·∫øn kh√≠ch h·ªç truy c·∫≠p trang ƒë·∫∑t ph√≤ng ƒë·ªÉ xem chi ti·∫øt.\n   - **Hu·ª∑ / ƒë·ªïi l·ªãch:** gi·∫£i th√≠ch ch√≠nh s√°ch c∆° b·∫£n (tr√≠ch t·ª´ FAQ n·∫øu c√≥).\n   - **Gi·ªù ƒë·∫∑t ph√≤ng: d·ª±a v√†o tool Date Time ƒë·ªÉ bi·∫øt gi·ªù ch√≠nh x√°c v√† d√πng chat model ƒë·ªÉ t√≠nh to√°n: ch·ªâ cho ƒë·∫∑t ph√≤ng tr∆∞·ªõc gi·ªù check in 30 ph√∫t v√≠ d·ª• nh∆∞ b√¢y gi·ªù l√† 12h th√¨ ch·ªâ ƒë·∫∑t ƒë∆∞·ª£c ph√≤ng t·ª´ 12h30p tr·ªü ƒëi /\nGi·ªù ho·∫°t ƒë·ªông/li√™n h·ªá:** tr·∫£ l·ªùi ch√≠nh x√°c theo d·ªØ li·ªáu.\n5Ô∏è‚É£ Lu√¥n gi·ªØ phong c√°ch Panacea:\n   - Gi·ªçng nh·∫π nh√†ng, l·ªãch s·ª±, t·∫°o c·∫£m gi√°c tin t∆∞·ªüng v√† an nhi√™n.\n   - Khi tr·∫£ l·ªùi xong, n·∫øu ph√π h·ª£p, c√≥ th·ªÉ g·ª£i √Ω h√†nh ƒë·ªông ti·∫øp theo (v√≠ d·ª•: ‚ÄúB·∫°n mu·ªën m√¨nh h·ªó tr·ª£ ƒë·∫∑t ph√≤ng ngay kh√¥ng?‚Äù).\n\nC·∫•u tr√∫c ph·∫£n h·ªìi:\n- C√¢u m·ªü th√¢n thi·ªán, c√≥ c·∫£m x√∫c nh·∫π.\n- Tr·∫£ l·ªùi ng·∫Øn g·ªçn, ƒë√∫ng tr·ªçng t√¢m.\n- N·∫øu c·∫ßn, g·ª£i √Ω th√™m m·ªôt b∆∞·ªõc k·∫ø ti·∫øp ƒë·ªÉ gi·ªØ flow tr√≤ chuy·ªán.\n-B·∫•t c·ª© ph·∫£n h·ªìi n√†o c√≥ ch·ªØ Panacea th√¨ in ƒë·∫≠m l√™n.\n\nV√≠ d·ª•:\nKh√°ch: ‚ÄúGi√° d·ªãch v·ª• ·ªü Catharsis l√† bao nhi√™u?‚Äù\n‚Üí B·∫°n: ‚ÄúGi√° d·ªãch v·ª• t·∫°i khu Catharsis thay ƒë·ªïi theo t·ª´ng lo·∫°i li·ªáu tr√¨nh v√† khung gi·ªù. B·∫°n c√≥ mu·ªën m√¨nh gi√∫p tra nhanh l·ªãch ƒë·∫∑t ph√≤ng h√¥m nay kh√¥ng?‚Äù"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        -192,
        -224
      ],
      "id": "37c98989-7ed6-4d75-8560-96a9120b215c",
      "name": "AI Agent"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        -288,
        -32
      ],
      "id": "f93afd70-a192-45f3-9d11-5a3f107f5f62",
      "name": "Google Gemini Chat Model",
      "credentials": {
        "googlePalmApi": {
          "id": "W3ctCr7Ek9nWaUHa",
          "name": "Gemini_ChatbotZalo"
        }
      }
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={\n  \"response\": {{ $json.data.message.text.toJsonString() }}\n}",
        "options": {
          "responseHeaders": {
            "entries": [
              {
                "name": "Access-Control-Allow-Origin",
                "value": "*"
              },
              {
                "name": "Access-Control-Allow-Methods",
                "value": "POST, OPTIONS, GET"
              },
              {
                "name": "Access-Control-Allow-Headers",
                "value": "Content-Type, Authorization"
              },
              {
                "name": "Content-Type",
                "value": "application/json"
              }
            ]
          }
        }
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.4,
      "position": [
        528,
        -224
      ],
      "id": "ad49dbe7-9aed-4c95-a64d-db6a82445401",
      "name": "Respond to Webhook"
    },
    {
      "parameters": {
        "jsCode": "// L·∫•y ID kh√°ch h√†ng an to√†n (th·ª≠ nhi·ªÅu ngu·ªìn, tr√°nh l·ªói \"Referenced node doesn't exist\")\nlet customerId = null;\n\n// L·∫•y text message t·ª´ node tr∆∞·ªõc (AI Agent / node tr∆∞·ªõc Code)\nlet messageText = \"\";\ntry {\n  messageText = $input.first().json.output || $input.first().json.message || $input.first().json.text || \"\";\n} catch (e) {\n  messageText = \"\";\n}\n\n// T·∫°o body gi·ªëng ƒë·ªãnh d·∫°ng b·∫°n mu·ªën\nconst body = {\n  recipient: {\n    id: customerId\n  },\n  message: {\n    text: messageText\n  }\n};\n\n// Tr·∫£ v·ªÅ chu·∫©n n8n; b·∫°n y√™u c·∫ßu data: body n√™n m√¨nh g√≥i trong json.data\nreturn [{ json: { data: body } }];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        288,
        -224
      ],
      "id": "b9249bd4-8b34-4547-8178-5a4fffa9c54e",
      "name": "Code"
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1D7jv5YIW3jaRExmpVLKOASmifiBKjQoyF_Nu0bvTlWM",
          "mode": "list",
          "cachedResultName": "Chatbot Panacea",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1D7jv5YIW3jaRExmpVLKOASmifiBKjQoyF_Nu0bvTlWM/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "FAQ",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1D7jv5YIW3jaRExmpVLKOASmifiBKjQoyF_Nu0bvTlWM/edit#gid=0"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheetsTool",
      "typeVersion": 4.7,
      "position": [
        112,
        176
      ],
      "id": "bb977a0c-e0c1-46b8-9393-64ec8de78e15",
      "name": "Get row(s) in sheet in Google Sheets",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "IqCDhPZuhnP0mK9t",
          "name": "Google Sheets chatbotZalo"
        }
      }
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $json.body.sessionId }}",
        "contextWindowLength": 10
      },
      "type": "@n8n/n8n-nodes-langchain.memoryPostgresChat",
      "typeVersion": 1.3,
      "position": [
        -144,
        -32
      ],
      "id": "cf20a54b-8501-4555-b6cd-f531e2125d1f",
      "name": "Postgres Chat Memory",
      "credentials": {
        "postgres": {
          "id": "9zQ1USarPOIKdVvN",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.dateTimeTool",
      "typeVersion": 2,
      "position": [
        -48,
        176
      ],
      "id": "8e350476-5fd8-49e5-93a0-d1476f7fe4aa",
      "name": "Date & Time"
    },
    {
      "parameters": {
        "content": "## Tool\n",
        "height": 208,
        "width": 384,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -80,
        128
      ],
      "typeVersion": 1,
      "id": "ffeca2e4-5366-460b-9d63-b170225a5537",
      "name": "Sticky Note"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "fcca7b85-70f7-4e33-91f9-db3ede7a70bc",
              "leftValue": "={{\n  ($json.body?.message || '')\n    .toString()\n    .normalize('NFD').replace(/[\\u0300-\\u036f]/g,'')\n    .toLowerCase()\n    .match(/(toi muon gap|gap tu van|tu van vien|lien he tu van|noi chuyen voi nguoi that|gap support|ket noi tu van|gap chuyen vien|gap con nguoi)/)\n    !== null\n}}",
              "rightValue": "=t√¥i mu·ªën g·∫∑p t∆∞ v·∫•n vi√™n",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            }
          ],
          "combinator": "or"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -656,
        -240
      ],
      "id": "afd02e26-7ead-4341-bb26-bf3ae8e65b2f",
      "name": "If1",
      "alwaysOutputData": false
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={\n  \"response\": {{ $json.data.message.text.toJsonString() }}\n}",
        "options": {}
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.4,
      "position": [
        -192,
        -432
      ],
      "id": "d5c4d639-4a73-448f-bb00-7de55a2e86b1",
      "name": "Respond to Webhook1"
    },
    {
      "parameters": {
        "jsCode": "// L·∫•y ID kh√°ch h√†ng t·ª´ Webhook payload\nconst senderId = $input.first().json.body.sessionId;\n\n// Format tin nh·∫Øn ph·∫£n h·ªìi\nconst body = {\n  recipient: {\n    id: senderId\n  },\n  message: {\n    text: \"D·∫° Panacea xin ch√†o qu√Ω kh√°ch üåø  vui l√≤ng ch·ªù ƒë·ªÉ ƒë∆∞·ª£c k·∫øt n·ªëi t∆∞ v·∫•n vi√™n trong gi√¢y l√°t...\"\n  }\n};\n\n// Tr·∫£ v·ªÅ ƒë·ªÉ node RespondToWebhook nh·∫≠n ƒë√∫ng d·ªØ li·ªáu\nreturn [{ json: { data: body } }];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -400,
        -432
      ],
      "id": "3879b493-1fa0-4de2-9170-a2d881a3d8fe",
      "name": "Code1"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "203a5a4f-0937-4560-bef3-e17d00399794",
              "name": "body.sessionId",
              "value": "={{ $json.body.sessionId }}",
              "type": "string"
            },
            {
              "id": "19f256c5-a12d-4bca-9add-eea412f83e9e",
              "name": "body.message",
              "value": "={{ $json.body.message }}",
              "type": "string"
            },
            {
              "id": "c47be752-736d-4238-85a1-5baec4b502dd",
              "name": "body.timestamp",
              "value": "={{ $json.body.timestamp }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -400,
        -224
      ],
      "id": "b22fc95a-4035-40d2-98ae-1e22d276ae0b",
      "name": "Edit Fields"
    }
  ],
  "pinData": {},
  "connections": {
    "Webhook": {
      "main": [
        [
          {
            "node": "If1",
            "type": "main",
            "index": 0
          }
        ],
        []
      ]
    },
    "Google Gemini Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent": {
      "main": [
        [
          {
            "node": "Code",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code": {
      "main": [
        [
          {
            "node": "Respond to Webhook",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get row(s) in sheet in Google Sheets": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Postgres Chat Memory": {
      "ai_memory": [
        [
          {
            "node": "AI Agent",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Date & Time": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "If1": {
      "main": [
        [
          {
            "node": "Code1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Edit Fields",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code1": {
      "main": [
        [
          {
            "node": "Respond to Webhook1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "8e587b29-191b-471a-9c3d-1f9bdba711dd",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "bd419a48632fb1f635856dd304975fd4b4ae8a3de478b36da304b5904d6fe8d9"
  },
  "id": "QxgvgJ7aYufHn9Cx",
  "tags": []
}