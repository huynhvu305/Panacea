<!-- HERO SECTION -->
<section class="hero-section">
  <img src="assets/images/BACKGROUND.webp" alt="H√¨nh n·ªÅn Panacea - ƒê·ªïi qu√† th√†nh vi√™n Panacea" 
    title="H√¨nh n·ªÅn Panacea - ƒê·ªïi qu√† th√†nh vi√™n Panacea" />
  <div class="banner-inner container">
    <div class="hero-content">
      <h1 class="hero-title">ƒê·ªïi Qu√† Th√†nh Vi√™n <span class="accent">Panacea</span></h1>
      <p class="hero-subtitle">T√≠ch xu m·ªói khi s·ª≠ d·ª•ng d·ªãch v·ª•, ƒë·ªïi voucher gi·∫£m gi√° v√† qu√† t·∫∑ng ƒë·ªôc quy·ªÅn</p>
      <div class="hero-cta">
        <button class="btn btn-primary" (click)="scrollToExchange()">
          <i class="bi bi-gift"></i> Xem qu√† ngay
        </button>
        <a *ngIf="!isLoggedIn" routerLink="/login" class="btn btn-outline">
          <i class="bi bi-box-arrow-in-right"></i> ƒêƒÉng nh·∫≠p ƒë·ªÉ t√≠ch xu
        </a>
      </div>
    </div>
  </div>
</section>

<!-- FEATURES SECTION -->
<section class="features-section scroll-reveal">
  <div class="container">
    <h2 class="section-title">T·∫°i sao ch·ªçn Panacea Xu?</h2>
    <div class="features-grid">
      <div class="feature-card" *ngFor="let feature of features">
        <div class="feature-icon">
          <i class="bi" [ngClass]="feature.icon"></i>
        </div>
        <h3 class="feature-title">{{ feature.title }}</h3>
        <p class="feature-description">{{ feature.description }}</p>
      </div>
    </div>
  </div>
</section>

<!-- HOW IT WORKS SECTION -->
<section class="how-it-works-section scroll-reveal">
  <div class="container">
    <h2 class="section-title">C√°ch th·ª©c ho·∫°t ƒë·ªông</h2>
    <div class="how-it-works-grid">
      <div class="step-card" *ngFor="let step of howItWorks">
        <div class="step-number">{{ step.step }}</div>
        <h3 class="step-title">{{ step.title }}</h3>
        <p class="step-description">{{ step.description }}</p>
      </div>
    </div>
  </div>
</section>

<!-- CTA SECTION -->
<section class="cta-section scroll-reveal">
  <div class="cta-banner-wrapper">
    <img src="assets/images/bannerpromotion.webp"
      alt="Banner khuy·∫øn m√£i t√≠ch xu - ƒêƒÉng nh·∫≠p ngay ƒë·ªÉ t√≠ch xu v√† ƒë·ªïi qu√† h·∫•p d·∫´n t·∫°i Panacea"
      title="Banner khuy·∫øn m√£i t√≠ch xu - ƒêƒÉng nh·∫≠p ngay ƒë·ªÉ t√≠ch xu v√† ƒë·ªïi qu√† h·∫•p d·∫´n t·∫°i Panacea"
      class="cta-banner-image" />
  </div>
</section>

<!-- EXCHANGE SECTION (Gi·ªØ nguy√™n c·∫•u tr√∫c t·ª´ exchange.html) -->
<div class="page scroll-reveal" id="exchange-section">
  <!-- üîπ ƒêi·ªÉm hi·ªán t·∫°i v√† B·ªô l·ªçc (G·ªôp chung) -->
  <div class="top-section">
    <!-- ƒêi·ªÉm hi·ªán t·∫°i -->
    <div class="points-card-compact">
      <div class="points-content-compact">
        <div class="points-icon-compact">
          <i class="bi bi-coin"></i>
        </div>
        <div class="points-info-compact">
          <p class="points-label-compact">S·ªë ƒëi·ªÉm hi·ªán c√≥</p>
          <h3 class="points-value-compact">
            <span>{{ userPoints | number }}</span>
            <span class="points-unit-compact">Xu</span>
          </h3>
        </div>
      </div>
    </div>

    <!-- üîπ B·ªô l·ªçc v√† t√¨m ki·∫øm -->
    <div class="filter-section-compact">
      <!-- H√†ng 1: Search + Category Tabs -->
      <div class="filter-row-top">
        <!-- Search Box -->
        <div class="search-box-compact">
          <i class="bi bi-search"></i>
          <input type="text" [(ngModel)]="searchQuery" (input)="onSearch()" (keydown.enter)="onSearch()"
            placeholder="T√¨m ki·∫øm..." class="search-input-compact" />
          <button type="button" class="btn-clear-search-compact" *ngIf="searchQuery" (click)="clearSearch()"
            title="X√≥a t√¨m ki·∫øm">
            <i class="bi bi-x-lg"></i>
          </button>
        </div>

        <!-- Category Tabs -->
        <div class="category-tabs-compact">
          <button class="tab-btn-compact" [class.active]="selectedCategory === 'all'" (click)="changeCategory('all')">
            <i class="bi bi-grid"></i> T·∫•t c·∫£
          </button>
          <button class="tab-btn-compact" [class.active]="selectedCategory === 'voucher'"
            (click)="changeCategory('voucher')">
            <i class="bi bi-ticket-perforated"></i> Voucher
          </button>
          <button class="tab-btn-compact" [class.active]="selectedCategory === 'item'" (click)="changeCategory('item')">
            <i class="bi bi-gift"></i> V·∫≠t ph·∫©m
          </button>
        </div>
      </div>

      <!-- H√†ng 2: Filter Group -->
      <div class="filter-row-bottom">
        <div class="filter-group">
          <div class="filter-group-header">
            <i class="bi bi-funnel"></i>
            <span>B·ªô l·ªçc</span>
          </div>
          <div class="filter-group-content">
            <!-- S·∫Øp x·∫øp theo ƒëi·ªÉm -->
            <div class="filter-item">
              <i class="bi bi-coin" aria-hidden="true"></i>
              <label for="points-sort" class="sr-only">S·∫Øp x·∫øp theo ƒëi·ªÉm</label>
              <select id="points-sort" [(ngModel)]="pointsSort" (change)="changePointsSort(pointsSort)" class="filter-select" aria-label="S·∫Øp x·∫øp theo ƒëi·ªÉm">
                <option value="none">S·∫Øp x·∫øp ƒëi·ªÉm</option>
                <option value="low">ƒêi·ªÉm: Th·∫•p ‚Üí Cao</option>
                <option value="high">ƒêi·ªÉm: Cao ‚Üí Th·∫•p</option>
              </select>
            </div>
            <div class="filter-divider"></div>
            <!-- S·∫Øp x·∫øp theo t√™n -->
            <div class="filter-item">
              <i class="bi bi-sort-alpha-down" aria-hidden="true"></i>
              <label for="name-sort" class="sr-only">S·∫Øp x·∫øp theo t√™n</label>
              <select id="name-sort" [(ngModel)]="nameSort" (change)="changeNameSort(nameSort)" class="filter-select" aria-label="S·∫Øp x·∫øp theo t√™n">
                <option value="none">S·∫Øp x·∫øp t√™n</option>
                <option value="asc">T√™n: A ‚Üí Z</option>
                <option value="desc">T√™n: Z ‚Üí A</option>
              </select>
            </div>
            <div class="filter-divider"></div>
            <!-- L·ªçc theo ƒëi·ªÉm -->
            <div class="filter-item">
              <i class="bi bi-funnel-fill" aria-hidden="true"></i>
              <label for="points-filter" class="sr-only">L·ªçc theo ƒëi·ªÉm</label>
              <select id="points-filter" [(ngModel)]="pointsFilter" (change)="changePointsFilter(pointsFilter)" class="filter-select" aria-label="L·ªçc theo ƒëi·ªÉm">
                <option value="all">T·∫•t c·∫£ ƒëi·ªÉm</option>
                <option value="0-200">0-200 Xu</option>
                <option value="200-400">200-400 Xu</option>
                <option value="400-600">400-600 Xu</option>
                <option value="600+">600+ Xu</option>
              </select>
            </div>
          </div>
          <!-- N√∫t x√≥a b·ªô l·ªçc -->
          <button class="btn-clear-filters" (click)="clearFilters()" title="X√≥a t·∫•t c·∫£ b·ªô l·ªçc">
            X√≥a
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- üîπ Khu v·ª±c voucher -->
  <h2 class="section-title scroll-reveal" *ngIf="selectedCategory === 'all' || selectedCategory === 'voucher'">
    Danh s√°ch Voucher
    <span class="count-badge" *ngIf="filteredVouchers.length !== vouchers.length">
      ({{ filteredVouchers.length }}/{{ vouchers.length }})
    </span>
  </h2>
  <div class="no-results scroll-reveal"
    *ngIf="(selectedCategory === 'all' || selectedCategory === 'voucher') && filteredVouchers.length === 0">
    <i class="bi bi-inbox"></i>
    <p>Kh√¥ng t√¨m th·∫•y voucher n√†o</p>
  </div>
  <div class="voucher-grid"
    *ngIf="(selectedCategory === 'all' || selectedCategory === 'voucher') && filteredVouchers.length > 0">
    <div class="voucher-card scroll-reveal" [class.delay-100]="i % 3 === 1" [class.delay-200]="i % 3 === 2"
      *ngFor="let v of filteredVouchers; let i = index">
      <div class="voucher-image-wrapper">
        <img [src]="v.img" [alt]="'H√¨nh ·∫£nh ' + v.type + ' - Panacea'" [title]="'Xem ·∫£nh l·ªõn ' + v.type"
          class="voucher-img" (error)="handleImageError($event)" (click)="openLightbox(v.img, v.type)"
          style="cursor: pointer;" />
      </div>
      <div class="voucher-body text-center">
        <h4 class="card-title">{{ v.type }}</h4>
        <p class="points-required">
          <i class="bi bi-coin"></i> C·∫ßn: <b>{{ v.pointsRequired | number }}</b> Xu
        </p>
        <button class="btn btn-redeem" (click)="redeemVoucher(v)">
          <i class="bi bi-ticket-perforated"></i> ƒê·ªïi ngay
        </button>
      </div>
    </div>
  </div>

  <!-- üîπ Khu v·ª±c v·∫≠t ph·∫©m -->
  <h2 class="section-title scroll-reveal" *ngIf="selectedCategory === 'all' || selectedCategory === 'item'">
    Danh s√°ch V·∫≠t ph·∫©m
    <span class="count-badge" *ngIf="filteredItems.length !== items.length">
      ({{ filteredItems.length }}/{{ items.length }})
    </span>
  </h2>
  <div class="no-results scroll-reveal"
    *ngIf="(selectedCategory === 'all' || selectedCategory === 'item') && filteredItems.length === 0">
    <i class="bi bi-inbox"></i>
    <p>Kh√¥ng t√¨m th·∫•y v·∫≠t ph·∫©m n√†o</p>
  </div>
  <div class="item-grid"
    *ngIf="(selectedCategory === 'all' || selectedCategory === 'item') && filteredItems.length > 0">
    <div class="item-card scroll-reveal" [class.delay-100]="idx % 3 === 1" [class.delay-200]="idx % 3 === 2"
      *ngFor="let i of filteredItems; let idx = index">
      <div class="item-image-wrapper">
        <img [src]="i.img" [alt]="'H√¨nh ·∫£nh ' + i.name + ' - Panacea'" [title]="'Xem ·∫£nh l·ªõn ' + i.name"
          class="item-img" (error)="handleImageError($event)" (click)="openLightbox(i.img, i.name)"
          style="cursor: pointer;" />
      </div>
      <div class="item-info text-center">
        <h4 class="card-title">{{ i.name }}</h4>
        <p class="points-required">
          <i class="bi bi-coin"></i> C·∫ßn: <b>{{ i.pointsRequired | number }}</b> Xu
        </p>
        <button class="btn btn-redeem" (click)="redeemItem(i)">
          <i class="bi bi-box-seam"></i> ƒê·ªïi ngay
        </button>
      </div>
    </div>
  </div>

</div>

<!-- LIGHTBOX (Xem ·∫£nh ph√≥ng to) -->
<div class="lightbox" *ngIf="lightboxImage" (click)="onLightboxOverlayClick($event)">
  <div class="lightbox-content" (click)="$event.stopPropagation()">
    <button class="lightbox-close" (click)="closeLightbox()" title="ƒê√≥ng (ESC)">
      <i class="bi bi-x-lg"></i>
    </button>
    <img [src]="lightboxImage" [alt]="lightboxTitle" class="lightbox-image" />
    <div class="lightbox-title" *ngIf="lightboxTitle">{{ lightboxTitle }}</div>
  </div>
</div>

<!-- FAQ SECTION -->
<section class="faq-section scroll-reveal">
  <div class="container">
    <h2 class="section-title">C√¢u h·ªèi th∆∞·ªùng g·∫∑p</h2>
    <div class="faq-list">
      <div class="faq-item" [class.active]="faq.isOpen" *ngFor="let faq of faqs; let i = index">
        <div class="faq-question" (click)="toggleFaq(i)">
          <h3>{{ faq.question }}</h3>
          <i class="bi bi-chevron-down"></i>
        </div>
        <div class="faq-answer" *ngIf="faq.isOpen">
          <p>{{ faq.answer }}</p>
        </div>
      </div>
    </div>
  </div>
</section>